(this.webpackJsonpmopidy_webui=this.webpackJsonpmopidy_webui||[]).push([[0],{106:function(e,t,n){e.exports=n(122)},118:function(e,t,n){},119:function(e,t,n){},122:function(e,t,n){"use strict";n.r(t);var a=n(12),r=n(7),i=n(0),c=n.n(i),o=n(10),l=n.n(o),s=n(20),u=n(37),d=n(68),p=n(60),m=n(45),f=n(29),h=n(55),y=n(44),g=n(56),b=n(115),_=n(116);function v(e){return e.replace(/(_[a-z])/g,(function(e){return e.toUpperCase().replace("_","")}))}var k=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(y.a)(t).call(this)))._console=n._getConsole(e||{}),n._settings=n._configure(e||{}),n._backoffDelay=n._settings.backoffDelayMin,n._pendingRequests={},n._webSocket=null,n._delegateEvents(),n._settings.autoConnect&&n.connect(),n}return Object(g.a)(t,e),Object(f.a)(t,[{key:"_getConsole",value:function(e){if("undefined"!==typeof e.console)return e.console;var t="undefined"!==typeof console&&console||{};return t.log=t.log||function(){},t.warn=t.warn||function(){},t.error=t.error||function(){},t}},{key:"_configure",value:function(e){var t=Object(r.a)({},e),n="undefined"!==typeof document&&"https:"===document.location.protocol?"wss://":"ws://",a="undefined"!==typeof document&&document.location.host||"localhost";return t.webSocketUrl=e.webSocketUrl||"".concat(n).concat(a,"/mopidy/ws"),!1!==e.autoConnect&&(t.autoConnect=!0),t.backoffDelayMin=e.backoffDelayMin||1e3,t.backoffDelayMax=e.backoffDelayMax||64e3,t}},{key:"_delegateEvents",value:function(){this.removeAllListeners("websocket:close"),this.removeAllListeners("websocket:error"),this.removeAllListeners("websocket:incomingMessage"),this.removeAllListeners("websocket:open"),this.removeAllListeners("state:offline"),this.on("websocket:close",this._cleanup),this.on("websocket:error",this._handleWebSocketError),this.on("websocket:incomingMessage",this._handleMessage),this.on("websocket:open",this._resetBackoffDelay),this.on("websocket:open",this._getApiSpec),this.on("state:offline",this._reconnect)}},{key:"off",value:function(){if(0===arguments.length)this.removeAllListeners();else if(1===arguments.length){var e=arguments.length<=0?void 0:arguments[0];if("string"!==typeof e)throw Error("Expected no arguments, a string, or a string and a listener.");this.removeAllListeners(e)}else this.removeListener.apply(this,arguments)}},{key:"connect",value:function(){var e=this;if(this._webSocket){if(this._webSocket.readyState===t.WebSocket.OPEN)return;this._webSocket.close()}this._webSocket=this._settings.webSocket||new t.WebSocket(this._settings.webSocketUrl),this._webSocket.onclose=function(t){e.emit("websocket:close",t)},this._webSocket.onerror=function(t){e.emit("websocket:error",t)},this._webSocket.onopen=function(){e.emit("websocket:open")},this._webSocket.onmessage=function(t){e.emit("websocket:incomingMessage",t),e.emit("requests:count",Object.keys(e._pendingRequests).length)}}},{key:"_cleanup",value:function(e){var n=this;Object.keys(this._pendingRequests).forEach((function(a){var r=n._pendingRequests[a].reject;delete n._pendingRequests[a];var i=new t.ConnectionError("WebSocket closed");i.closeEvent=e,r(i)})),this.emit("state","state:offline"),this.emit("state:offline")}},{key:"_reconnect",value:function(){var e=this;this.emit("state","reconnectionPending",{timeToAttempt:this._backoffDelay}),this.emit("reconnectionPending",{timeToAttempt:this._backoffDelay}),setTimeout((function(){e.emit("state","reconnecting"),e.emit("reconnecting"),e.connect()}),this._backoffDelay),this._backoffDelay=2*this._backoffDelay,this._backoffDelay>this._settings.backoffDelayMax&&(this._backoffDelay=this._settings.backoffDelayMax)}},{key:"_resetBackoffDelay",value:function(){this._backoffDelay=this._settings.backoffDelayMin}},{key:"close",value:function(){this.off("state:offline",this._reconnect),this._webSocket&&this._webSocket.close()}},{key:"_handleWebSocketError",value:function(e){this._console.warn("WebSocket error:",e.stack||e)}},{key:"_send",value:function(e){var n=this;switch(this._webSocket.readyState){case t.WebSocket.CONNECTING:return Promise.reject(new t.ConnectionError("WebSocket is still connecting"));case t.WebSocket.CLOSING:return Promise.reject(new t.ConnectionError("WebSocket is closing"));case t.WebSocket.CLOSED:return Promise.reject(new t.ConnectionError("WebSocket is closed"));default:return new Promise((function(t,a){var i=Object(r.a)({},e,{jsonrpc:"2.0",id:n._nextRequestId()});n._pendingRequests[i.id]={resolve:t,reject:a},n._webSocket.send(JSON.stringify(i)),n.emit("websocket:outgoingMessage",i),n.emit("requests:count",Object.keys(n._pendingRequests).length)}))}}},{key:"_handleMessage",value:function(e){try{var t=JSON.parse(e.data);Object.hasOwnProperty.call(t,"id")?this._handleResponse(t):Object.hasOwnProperty.call(t,"event")?this._handleEvent(t):this._console.warn("Unknown message type received. Message was: ".concat(e.data))}catch(n){if(!(n instanceof SyntaxError))throw n;this._console.warn("WebSocket message parsing failed. Message was: ".concat(e.data))}}},{key:"_handleResponse",value:function(e){if(Object.hasOwnProperty.call(this._pendingRequests,e.id)){var n=this._pendingRequests[e.id],a=n.resolve,r=n.reject;if(delete this._pendingRequests[e.id],Object.hasOwnProperty.call(e,"result"))a(e.result);else if(Object.hasOwnProperty.call(e,"error")){var i=new t.ServerError(e.error.message);i.code=e.error.code,i.data=e.error.data,r(i),this._console.warn("Server returned error:",e.error)}else{var c=new Error("Response without 'result' or 'error' received");c.data={response:e},r(c),this._console.warn("Response without 'result' or 'error' received. Message was:",e)}}else this._console.warn("Unexpected response received. Message was:",e)}},{key:"_handleEvent",value:function(e){var t=Object(r.a)({},e);delete t.event;var n="event:".concat(v(e.event));this.emit("event",n,t),this.emit(n,t)}},{key:"_getApiSpec",value:function(){return this._send({method:"core.describe"}).then(this._createApi.bind(this)).catch(this._handleWebSocketError.bind(this))}},{key:"_createApi",value:function(e){var t=this;Object.keys(e).forEach((function(n){var a,r=function(e){var t=e.split(".");return t.length>=1&&"core"===t[0]&&(t=t.slice(1)),t}(n),i=v(r.slice(-1)[0]),c=function(e){var n=t;return e.forEach((function(e){var t=v(e);n[t]=n[t]||{},n=n[t]})),n}(r.slice(0,-1));c[i]=(a=n,function(){for(var e={method:a},n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return 0===r.length?t._send(e):r.length>1?Promise.reject(new Error("Expected zero arguments, a single array, or a single object.")):Array.isArray(r[0])||r[0]===Object(r[0])?(e.params=r[0],t._send(e)):Promise.reject(new TypeError("Expected an array or an object."))}),c[i].description=e[n].description,c[i].params=e[n].params})),this.emit("state","state:online"),this.emit("state:online")}}]),t}(b),E=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(y.a)(t).call(this,e))).name="ConnectionError",n}return Object(g.a)(t,e),t}(Object(p.a)(Error));k.ConnectionError=E;var O=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(h.a)(this,Object(y.a)(t).call(this,e))).name="ServerError",n}return Object(g.a)(t,e),t}(Object(p.a)(Error));k.ServerError=O,k.WebSocket=_,k.prototype._nextRequestId=function(){var e=-1;return function(){return e+=1}}();var w=k,A=(n(117),n(118),n(16)),C=(n(119),n(148)),S=n(123),j=n(69),I=n.n(j),x=n(71),P=n.n(x),L=n(50),N=n.n(L),T=n(70),R=n.n(T),D=function(e){var t=e.state,n=e.mopidy;return c.a.createElement(C.a,null,c.a.createElement(S.a,{onClick:function(){return n.playback.previous()}},c.a.createElement(I.a,{fontSize:"large"})),"playing"===t?c.a.createElement(S.a,{onClick:function(){return n.playback.pause()}},c.a.createElement(R.a,{fontSize:"large"})):c.a.createElement(S.a,{onClick:function(){return n.playback.play()}},c.a.createElement(N.a,{fontSize:"large"})),c.a.createElement(S.a,{onClick:function(){return n.playback.next()}},c.a.createElement(P.a,{fontSize:"large"})))},B=n(167),Y=n(152),M=function(e){if(void 0===e||null===e)return"??";var t=Math.ceil(e/1e3),n=t%60,a=n<10?"0"+n:""+n;return"".concat((t-n)/60,":").concat(a)},K=function(e,t){return e[t]},U={spotify:"Spotify",spotifytunigo:"Spotify browse",spotifyweb:"Spotify browse",local:"Local media",m3u:"Local playlists",podcast:"Podcasts","podcast+itunes":"iTunes Store: Podcasts",dirble:"Dirble",tunein:"TuneIn",soundcloud:"SoundCloud",gmusic:"Google Music",internetarchive:"Internet Archive",somafm:"Soma FM",youtube:"YouTube",audioaddict:"AudioAddict",subsonic:"Subsonic"},F=["file","http","https","mms","rtmp","rtmps","rtsp","yt"],q=function(e){var t=e.time_position,n=e.track_length,a=e.dispatch,r=e.mopidy;return n?c.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},c.a.createElement("div",null,M(t)),c.a.createElement(B.a,{value:t/n*300,onChange:function(e,t){a({type:"PLAYBACK_INFO",target:"time_position",data:t*n/300})},onChangeCommitted:function(e,t){r.playback.seek({time_position:Math.ceil(t*n/300)})},max:300,valueLabelDisplay:"auto",valueLabelFormat:function(e){return M(e*n/300)},style:{flex:1,marginRight:"5%",marginLeft:"5%"}}),c.a.createElement("div",null,M(n))):c.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},c.a.createElement("div",null,M(t)),c.a.createElement(Y.a,{style:{flex:1,marginRight:"5%",marginLeft:"5%"}}))},z=n(72),W=n.n(z),G=n(73),H=n.n(G),V=function(e){var t=e.volume,n=e.dispatch,a=e.style,i=e.mopidy;return c.a.createElement("div",{style:Object(r.a)({display:"flex",flexDirection:"row",alignItems:"center"},a)},c.a.createElement("div",null,c.a.createElement(W.a,null)),c.a.createElement("div",{style:{flex:1,marginLeft:"5%",marginRight:"5%"}},c.a.createElement(B.a,{value:t,onChange:function(e,t){n({type:"PLAYBACK_INFO",target:"volume",data:t})},onChangeCommitted:function(e,t){i.mixer.setVolume({volume:t})},valueLabelDisplay:"auto"})),c.a.createElement("div",null,c.a.createElement(H.a,null)))},J=n(18),X=n.n(J),$=n(28),Q=function(){var e=Object($.a)(X.a.mark((function e(t,n){var a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[{fun_path:["playback","getCurrentTlTrack"],base:{type:"PLAYBACK_INFO",target:"tltrack"}},{fun_path:["playback","getState"],base:{type:"PLAYBACK_INFO",target:"state"}},{fun_path:["playback","getTimePosition"],base:{type:"PLAYBACK_INFO",target:"time_position"}}],e.next=3,Promise.all(a.map(function(){var e=Object($.a)(X.a.mark((function e(a){var r,i,c,o;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.fun_path,i=a.base,r.reduce((function(e,t){return e[t]}),n),c=r.reduce(K,n),e.next=5,c();case 5:o=e.sent,t(Object.assign({},i,{data:o}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Z=function(e,t,n){t.on("requests:count",(function(e){n({type:"MOPIDY_PENDING_REQUESTS_COUNT",data:e})})),t.on("state:online",(function(){n({type:"MOPIDY_CLIENT_CONNECTED"}),t.tracklist.getTlTracks().then((function(e){return n({type:"TRACKLIST_INITIALISE",data:e})})),t.mixer.getVolume().then((function(e){return n({type:"PLAYBACK_INFO",target:"volume",data:e})})),t.library.browse({uri:null}).then((function(e){return n({type:"LIBRARY_POPULATE",target:["root"],data:[].concat(Object(a.a)(e),[{name:"Playlists",uri:"playlist:",type:"playlists_root"},{name:"Search results",uri:"search:",type:"search_results_root"}])})})),t.getUriSchemes().then((function(e){return n({type:"URI_SCHEMES",data:e})})),Q(n,t)})),t.on("state:offline",(function(){return n({type:"MOPIDY_CLIENT_DISCONNECTED"})})),t.on("event:trackPlaybackResumed",(function(e){n({type:"PLAYBACK_INFO",target:"state",data:"playing"}),n({type:"PLAYBACK_INFO",target:"time_position",data:e.time_position})})),t.on("event:trackPlaybackPaused",(function(e){n({type:"PLAYBACK_INFO",target:"state",data:"paused"}),n({type:"PLAYBACK_INFO",target:"time_position",data:e.time_position}),n({type:"INCR_PLAYBACK_RESET"})})),t.on("event:seeked",(function(e){n({type:"PLAYBACK_INFO",target:"time_position",data:e.time_position})})),t.on("event:trackPlaybackStarted",(function(e){n({type:"PLAYBACK_INFO",target:"track",data:e.track})})),t.on("event:trackPlaybackEnded",(function(e){n({type:"PLAYBACK_INFO",target:"state",data:"stopped"}),n({type:"PLAYBACK_INFO",target:"time_position",data:e.time_position})})),t.on("event:trackPlaybackStarted",(function(e){n({type:"PLAYBACK_INFO",target:"state",data:"playing"}),n({type:"PLAYBACK_INFO",target:"time_position",data:0}),n({type:"PLAYBACK_INFO",target:"tltrack",data:e.tl_track})})),t.on("event:tracklistChanged",(function(){t.tracklist.getTlTracks().then((function(e){return n({type:"TRACKLIST_INITIALISE",data:e})})),Q(n,t)}))},ee=function(e,t){return function(){return function(n,a){var r=a().mopidy;e.reduce(K,r)().then((function(e){n(Object.assign({},t,{data:e}))}))}}},te=(ee(["playback","getCurrentTrack"],{type:"PLAYBACK",target:"track"}),ee(["playback","getState"],{type:"PLAYBACK",target:"state"}),ee(["playback","getTimePosition"],{type:"PLAYBACK",target:"time_position"}),function(e){var t=e.track;if(!t)return"...";var n=t.name?c.a.createElement("div",null,t.name):null,a=t.album?c.a.createElement("div",null,t.album.name):null,r=t.artists?c.a.createElement("div",null,t.artists[0].name):null;return t.album,c.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},n,a,r)}),ne=function(e){var t=e.tltrack,n=e.state,a=e.time_position,r=e.time_position_updater,i=(e.updating,e.volume),o=e.seek_update_interval,l=e.mopidy,s=e.dispatch;return"playing"!==n||"number"!==typeof a||r.pending||(s({type:"INCR_PLAYBACK_START"}),setTimeout((function(){return s({type:"INCR_PLAYBACK"})}),o)),c.a.createElement("div",{style:{width:"80%",margin:"auto",display:"flex",flexDirection:"row"}},c.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},c.a.createElement(D,{state:n,mopidy:l}),c.a.createElement(V,{volume:i,dispatch:s,mopidy:l,style:{marginTop:"auto",marginBottom:"auto"}})),c.a.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1,paddingLeft:"5%",paddingRight:"5%"}},c.a.createElement(te,{track:t.track}),c.a.createElement(q,{time_position:a,track_length:t.track?t.track.length:null,dispatch:s,mopidy:l}),c.a.createElement("div",null)))},ae=ne=Object(s.b)((function(e){return Object(r.a)({},e.playback_state,{mopidy:e.mopidy.mopidy,seek_update_interval:e.settings.persistant.seek_update_interval})}))(ne),re=n(21),ie=n(74),ce=n.n(ie),oe=n(75),le=n.n(oe),se=n(76),ue=n.n(se),de=n(162),pe=n(163),me=n(158),fe=n(155),he=n(161),ye=function(e){var t=e.mopidy,n=e.searchUris,a=e.dispatch,o=e.closePopover,l=localStorage.getItem("searchSelectedURI")||"all",s=Object(i.useState)(l),u=Object(re.a)(s,2),d=u[0],p=u[1],m=Object(i.useState)(""),f=Object(re.a)(m,2),h=f[0],y=f[1],g=function(e){if("Enter"===e&&0!==h.length){var n="all"===d?{}:{uris:[d+":"]};t.library.search(Object(r.a)({query:{any:h}},n)).then((function(e){var t=e.map((function(e){return Object(r.a)({},e,{name:e.uri,children:e.tracks,type:"search_result",expanded:!0})}));a({type:"LIBRARY_ADD_CHILDREN",data:t,target:["root","search:"]}),a({type:"LIBRARY_SET_EXPANDED",target:["root","search:"],data:!0})})),o()}};return c.a.createElement("div",null,c.a.createElement(pe.a,{id:"search-popover-textinput",variant:"outlined",value:h,onChange:function(e){return y(e.target.value)},onKeyPress:function(e){return g(e.key)},autoFocus:!0}),c.a.createElement(fe.a,{variant:"outlined"},c.a.createElement(he.a,{native:!0,value:d,onChange:function(e){localStorage.setItem("searchSelectedURI",e.target.value),p(e.target.value)},onKeyPress:function(e){return g(e.key)}},c.a.createElement("option",{value:"all"},"All"),n.map((function(e){var t=Object(re.a)(e,2),n=t[0],a=t[1];return c.a.createElement("option",{value:n,key:n},a)})))))},ge=function(e){var t=e.pendingRequestsNb;return e.connected?0===t?c.a.createElement("div",null,c.a.createElement(me.a,{size:30,thickness:5,style:{marginTop:"10px",marginBottom:"10px"},variant:"determinate",value:100})):c.a.createElement("div",null,c.a.createElement(me.a,{size:30,thickness:5,style:{marginTop:"10px",marginBottom:"10px"}})):c.a.createElement("div",null,c.a.createElement(me.a,{size:30,thickness:5,style:{marginTop:"10px",marginBottom:"10px"},color:"secondary"}))},be=Object(s.b)((function(e){return e.mopidy}))((function(e){var t=e.dispatch,n=e.mopidy,a=e.uri_schemes,r=e.pendingRequestsNb,o=e.connected,l=Object(i.useRef)(null),s=Object(i.useState)(!1),u=Object(re.a)(s,2),d=u[0],p=u[1],m=a.filter((function(e){return!F.includes(e)})).map((function(e){return[e,U[e]||e]}));return c.a.createElement(c.a.Fragment,null,c.a.createElement(C.a,{orientation:"vertical"},c.a.createElement(ge,{pendingRequestsNb:r,connected:o}),c.a.createElement(S.a,{style:{height:"auto"},onClick:function(){return t({type:"ACTIVATE_PANEL",target:"control"})}},c.a.createElement(ce.a,null)),c.a.createElement(S.a,{onClick:function(){return t({type:"ACTIVATE_PANEL",target:"library"})}},c.a.createElement(le.a,null)),c.a.createElement(S.a,{ref:l,id:"popover-search-button",onClick:function(){return p(!0)}},c.a.createElement(ue.a,null)),c.a.createElement(de.a,{id:"search-popover",open:d,anchorEl:l.current,onClose:function(){return p(!1)},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"}},c.a.createElement(ye,{searchUris:m,mopidy:n,dispatch:t,closePopover:function(){return p(!1)}}))))})),_e=n(54),ve=n(78),ke=n.n(ve),Ee=n(81),Oe=n.n(Ee),we=n(79),Ae=n.n(we),Ce=n(166),Se=n(157),je=n(159),Ie=n(160),xe=n(165),Pe=function(e){e.dispatch;var t=e.tracklist,n=e.current_tlid,a=e.mopidy;return c.a.createElement(_e.a,{list:t,setList:function(){},tag:Se.a,style:{overflow:"auto",maxHeight:"100%",padding:0},group:{name:"tracklist",pull:!0,put:["library"]},onEnd:function(e){return function(e,t){t.tracklist.move({start:e.oldIndex,end:e.oldIndex,to_position:e.newIndex})}(e,a)},id:"tracklist"},t.map((function(e){return c.a.createElement(je.a,{key:e.tlid,className:e.tlid===n?"tracklist_current":"",style:{padding:0}},e.tlid===n?c.a.createElement(ke.a,{fontSize:"small"}):"",c.a.createElement(xe.a,null,function(e){try{return"".concat(e.track.album.name," / ").concat(e.track.track_no,". ").concat(e.track.name)}catch(t){return e.track.name||e.track.uri}}(e)),c.a.createElement(Ie.a,null,c.a.createElement(C.a,null,c.a.createElement(S.a,{onClick:function(){return a.playback.play({tlid:e.tlid})}},c.a.createElement(N.a,{fontSize:"small"})),c.a.createElement(S.a,{onClick:function(){return a.tracklist.remove({criteria:{tlid:[e.tlid]}})}},c.a.createElement(Ae.a,{fontSize:"small"})))))})))},Le=function(e){var t=e.tracklist,n=e.mopidy;return c.a.createElement("div",null,t.length," tracks",c.a.createElement(Ce.a,{title:"Clear playlist"},c.a.createElement(S.a,{onClick:function(){return n.tracklist.clear()}},c.a.createElement(Oe.a,{fontSize:"small"}))))},Ne=function(e){var t=e.tracklist,n=e.current_tlid,a=e.dispatch,r=e.mopidy;return c.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%"}},c.a.createElement(Le,{tracklist:t,mopidy:r}),c.a.createElement(Pe,{tracklist:t,current_tlid:n,dispatch:a,mopidy:r,style:{overflow:"auto",height:"100%",maxHeight:"100%"}}))},Te=Ne=Object(s.b)((function(e){return{tracklist:e.tracklist,current_tlid:e.playback_state.tltrack?e.playback_state.tltrack.tlid:null,mopidy:e.mopidy.mopidy}}))(Ne),Re=n(83),De=n.n(Re),Be=n(82),Ye=n.n(Be),Me=n(85),Ke=n.n(Me),Ue=n(84),Fe=n.n(Ue),qe=function(e){return"track"===e.type||"Track"===e.__model__},ze=function(){var e=Object($.a)(X.a.mark((function e(t,n){var a;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,Promise.all(t.map(function(){var e=Object($.a)(X.a.mark((function e(t){var a,r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!qe(t)){e.next=4;break}return e.abrupt("return",t.uri);case 4:e.t0=t.type,e.next="playlist"===e.t0?7:"search_result"===e.t0?15:16;break;case 7:if(t.children){e.next=14;break}return e.next=10,n.playlists.getItems({uri:t.uri});case 10:return a=e.sent,e.abrupt("return",a.map((function(e){return e.uri})));case 14:case 15:return e.abrupt("return",t.children.map((function(e){return e.uri})));case 16:return e.next=18,n.library.browse({uri:t.uri});case 18:return 0===(r=e.sent).length&&t.children&&(r=t.children),e.next=22,ze(r,n);case 22:return e.abrupt("return",e.sent);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return a=e.sent,e.abrupt("return",a.flat());case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),We=function(){var e=Object($.a)(X.a.mark((function e(t,n){var a,r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze([t],n);case 2:return a=e.sent,r=a.filter((function(e){return null!==e})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ge=function(){var e=Object($.a)(X.a.mark((function e(t,n,a){var r;return X.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!qe(t)){e.next=4;break}a.tracklist.add({uris:[t.uri],at_position:n}),e.next=9;break;case 4:return e.next=6,We(t,a);case 6:return r=e.sent,e.next=9,a.tracklist.add({uris:r,at_position:n});case 9:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),He=function e(t){var n=t.item,a=t.dispatch,r=t.mopidy,i=t.depth,o=t.tl_length,l=t.disable_buttons,s=void 0!==l&&l;if(!n.expanded)return null;if(void 0===n.children)return null;return c.a.createElement(_e.a,{group:{name:"library",put:!1,pull:"clone"},list:n.children,setList:function(){},tag:Se.a,onEnd:function(e){!function(e,t,n,a){"tracklist"===n.id&&Ge(e,t,a)}(n.children[e.oldIndex],e.newIndex,e.to,r)},style:{paddingLeft:10*i+"px"}},n.children.map((function(t){return c.a.createElement(c.a.Fragment,{key:t.uri},c.a.createElement(je.a,{key:t.uri,style:{paddingTop:0,paddingBottom:0}},c.a.createElement(xe.a,{onClick:function(){return function(e,t,n){if("track"!==e.type&&"Track"!==e.__model__){switch(e.type){case"playlists_root":n.playlists.asList().then((function(n){return t({type:"LIBRARY_POPULATE",target:e.path,data:n})}));break;case"playlist":n.playlists.getItems({uri:e.uri}).then((function(n){return t({type:"LIBRARY_POPULATE",target:e.path,data:n||[]})}));break;case"search_results_root":case"search_result":break;default:n.library.browse({uri:e.uri}).then((function(n){return t({type:"LIBRARY_POPULATE",target:e.path,data:n})}))}t({type:"LIBRARY_TOGGLE_EXPANDED",target:e.path})}}(t,a,r)}},t.name,qe(n=t)?"":void 0===n.children?"(?)":"(".concat(n.children.length,")"),function(e){return qe(e)?"":e.expanded?c.a.createElement(Ye.a,{style:{verticalAlign:"text-bottom"}}):c.a.createElement(De.a,{style:{verticalAlign:"text-bottom"}})}(t)),s?null:c.a.createElement(Ie.a,null,c.a.createElement(C.a,{size:"small"},c.a.createElement(Ce.a,{title:"Play now !"},c.a.createElement(S.a,{onClick:function(){r.tracklist.clear(),Ge(t,0,r).then((function(){return r.playback.play()}))}},c.a.createElement(Fe.a,null))),c.a.createElement(Ce.a,{title:"Add to tracklist"},c.a.createElement(S.a,{onClick:function(){Ge(t,o,r)}},c.a.createElement(Ke.a,null)))))),c.a.createElement(e,{item:t,dispatch:a,mopidy:r,depth:i+1}));var n})))},Ve=Object(s.b)((function(e){return{library:e.library,mopidy:e.mopidy.mopidy,tl_length:e.tracklist.length,playlists:e.playlists}}))((function(e){var t=e.library,n=(e.playlists,e.tl_length),a=e.dispatch,r=e.mopidy,i=t.lib_tree;return i?0===i.length?null:c.a.createElement(He,{item:i,dispatch:a,mopidy:r,depth:0,tl_length:n,style:{overflow:"auto",height:"100%"},disable_buttons:!0}):null})),Je=Object(s.b)((function(e){return e.settings}))((function(e){var t=e.persistant,n=e.dispatch,a=Object(i.useState)(t.mopidy_ws),r=Object(re.a)(a,2),o=r[0],l=r[1],s=Object(i.useState)(t.seek_update_interval),u=Object(re.a)(s,2),d=u[0],p=u[1];return c.a.createElement("div",null,c.a.createElement("form",{noValidate:!0,autoComplete:"off"},c.a.createElement(pe.a,{label:"Mopidy websocket URL",variant:"outlined",style:{margin:8,width:"80%"},InputLabelProps:{shrink:!0},value:o,onChange:function(e){return l(e.target.value)}}),c.a.createElement(pe.a,{label:"Seek update interval",variant:"outlined",style:{margin:8},InputLabelProps:{shrink:!0},value:d,onChange:function(e){return p(e.target.value)}})),c.a.createElement(S.a,{onClick:function(){n({type:"COMMIT_PERSISTANT",data:{mopidy_ws:o,seek_update_interval:d}}),n({type:"CONNECT",mopidy_ws:o,dispatch:n})}},"Commit"))})),Xe=function(e){var t=e.children;return c.a.createElement("div",{className:"App",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"}},c.a.createElement("div",{style:Object(A.a)({display:"flex",flexDirection:"row",flex:"0",minHeight:"0"},"flex",1)},c.a.createElement(be,null),t),c.a.createElement(ae,{style:{display:"flex",flex:1}}))},$e=Object(s.b)((function(e){return{settings:e.settings,mopidy:e.mopidy}}))((function(e){var t=e.settings,n=e.mopidy,a=e.dispatch;n.connected||n.connecting||n.error||a({type:"CONNECT",mopidy_ws:t.persistant.mopidy_ws,dispatch:a});var r=null;switch(t.active_panel){case"control":r=c.a.createElement(Je,null);break;default:r=c.a.createElement(Ve,null)}return n.connected?c.a.createElement(Xe,null,c.a.createElement("div",{style:{height:"100%",width:"100%",flexDirection:"row",display:"flex"}},c.a.createElement("div",{style:{width:"50%",height:"100%",overflow:"auto"}},r),c.a.createElement("div",{style:{height:"100%",width:"50%"}},c.a.createElement(Te,null)))):c.a.createElement(Xe,null,c.a.createElement("div",{style:{width:"50%",height:"100%",overflow:"auto"}},c.a.createElement(Je,null)),c.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},c.a.createElement("div",{style:{flex:1}}),c.a.createElement("div",{style:{flex:1}},c.a.createElement(me.a,{color:"inherit",style:{margin:"auto"}})),c.a.createElement("div",{style:{flex:1}},c.a.createElement("div",null,"Trying to reach mopidy at ",t.persistant.mopidy_ws),c.a.createElement("div",null,n.error)),c.a.createElement("div",{style:{flex:1}})))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Qe={tltrack:{track:null,tlid:null},state:null,time_position:null,updating:!1,time_position_updater:{pending:!1,last_update:null},volume:null},Ze=function e(t,n,i,c){if(n[0]===t.uri){if(1===n.length){var o=i.map((function(e){return Object.assign(e,{path:[].concat(Object(a.a)(c),[e.uri])})}));return Object(r.a)({},t,{children:o})}return Object(r.a)({},t,{children:t.children.map((function(t){return e(t,n.slice(1),i,c)}))})}return t},et=function e(t,n,i,c,o){if(n[0]===t.uri){if(1===n.length){var l=i.map((function(e){return Object(r.a)({},e,{path:[].concat(Object(a.a)(c),[e.uri])})})),s=t.children||[],u=[];switch(o){case"before":u=[].concat(Object(a.a)(l),Object(a.a)(s));break;case"after":u=[].concat(Object(a.a)(s),Object(a.a)(l));default:u=l}return Object(r.a)({},t,{children:u})}return Object(r.a)({},t,{children:t.children.map((function(t){return e(t,n.slice(1),i,c,o)}))})}return t},tt=function e(t,n){return n[0]===t.uri?1===n.length?Object(r.a)({},t,{expanded:!t.expanded}):void 0===t.children?t:Object(r.a)({},t,{children:t.children.map((function(t){return e(t,n.slice(1))}))}):t},nt=function e(t,n,a){return n[0]===t.uri?1===n.length?Object(r.a)({},t,{expanded:a}):void 0===t.children?t:Object(r.a)({},t,{children:t.children.map((function(t){return e(t,n.slice(1),!0)}))}):t},at={active_panel:"library",persistant:JSON.parse(localStorage.getItem("settings"))||{mopidy_ws:function(){var e="https:"===window.location.protocol?"wss":"ws",t=window.location.hostname;return"".concat(e,"://").concat(t,":").concat(6680,"/mopidy/ws")}(),seek_update_interval:1e3}},rt=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,it=Object(u.e)(Object(u.c)({playback_state:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PLAYBACK_INFO":var n={};n[t.target]=t.data,"tltrack"!==t.target||t.data||(n[t.target]={track:null,tlid:null});var a=Object.assign({},e,n);return"time_position"===t.target&&(a.time_position_updater.last_update=(new Date).valueOf()),a;case"INCR_PLAYBACK_START":var i=Object.assign({},e.time_position_updater,{pending:!0});return Object.assign({},e,{time_position_updater:i});case"INCR_PLAYBACK":var c=(new Date).valueOf(),o=c-e.time_position_updater.last_update;return"playing"!==e.state?e:Object(r.a)({},e,{time_position:e.time_position+o,time_position_updater:{pending:!1,last_update:c}});case"INCR_PLAYBACK_RESET":return Object(r.a)({},e,{time_position_updater:{pending:!1,last_update:null}});case"PLAYBACK_UPDATING":return Object(r.a)({},e,{updating:t.data});default:return e}},tracklist:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TRACKLIST_INITIALISE":return t.data;default:return e}},library:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{lib_tree:{uri:"root",children:[],expanded:!0,path:["root"]},selected_uri:null},t=arguments.length>1?arguments[1]:void 0,n=null;switch(t.type){case"LIBRARY_POPULATE":return n=Ze(e.lib_tree,t.target,t.data,t.target),Object(r.a)({},e,{lib_tree:n});case"LIBRARY_ADD_CHILDREN":return n=et(e.lib_tree,t.target,t.data,t.target,t.mode),Object(r.a)({},e,{lib_tree:n});case"LIBRARY_TOGGLE_EXPANDED":return n=tt(e.lib_tree,t.target),Object(r.a)({},e,{lib_tree:n});case"LIBRARY_SET_EXPANDED":return n=nt(e.lib_tree,t.target,t.data),Object(r.a)({},e,{lib_tree:n});default:return e}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ACTIVATE_PANEL":return Object(r.a)({},e,{active_panel:t.target});case"COMMIT_PERSISTANT":return localStorage.setItem("settings",JSON.stringify(t.data)),Object(r.a)({},e,{persistant:t.data});default:return e}},mopidy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{connected:!1,connecting:!1,mopidy:null,uri_schemes:[],pendingRequestsNb:0,error:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MOPIDY_CLIENT_CONNECTED":return Object(r.a)({},e,{connected:!0,connecting:!1});case"MOPIDY_CLIENT_DISCONNECTED":return Object(r.a)({},e,{connected:!1,connecting:!0});case"MOPIDY_PENDING_REQUESTS_COUNT":return Object(r.a)({},e,{pendingRequestsNb:t.data});case"CONNECT":if(!t.dispatch||!t.mopidy_ws){var n="dispatch and mopidy_host must be passed at CONNECT";return console.log("ERROR: "+n),Object(r.a)({},e,{error:n,connecting:!0})}var a=t.mopidy_ws;console.log("webSocketUrl:",a),e.mopidy&&(e.mopidy.removeAllListeners(),e.mopidy.close(),e.mopidy.off());var i=new w({webSocketUrl:a,autoConnect:!1});try{i.connect()}catch(n){return console.log("Error when initializing mopidy",n),i.removeAllListeners(),i.close(),i.off(),Z(0,i,t.dispatch),Object(r.a)({},e,{error:n.toString(),mopidy:i,connecting:!1})}return window.$mopidy=i,Z(0,i,t.dispatch),Object(r.a)({},e,{connecting:!0,mopidy:i,connected:!1,error:null});case"URI_SCHEMES":return Object(r.a)({},e,{uri_schemes:t.data});default:return e}}}),rt(Object(u.a)(d.a)));window.$store=it,l.a.render(c.a.createElement(s.a,{store:it,style:{height:"100%"}},c.a.createElement($e,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[106,1,2]]]);
//# sourceMappingURL=main.7c733895.chunk.js.map